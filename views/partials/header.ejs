<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz App</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
      integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .btn-outline-success {
        --bs-btn-color: #7b4a9e;
        --bs-btn-border-color: #7b4a9e;
        --bs-btn-hover-bg: #7b4a9e;
        --bs-btn-hover-border-color: #7b4a9e;
        --bs-btn-active-bg: #7b4a9e;
        --bs-btn-active-border-color: #7b4a9e;
        --bs-btn-disabled-color: #7b4a9e;
        --bs-btn-disabled-border-color: #7b4a9e;
      }

      .top-nav {
        background-color: #7b4a9e;
        color: white;
        padding: 0.5rem 1rem;
      }

      .top-nav .navbar-nav {
        flex-direction: row;
        align-items: center;
      }

      .top-nav .nav-item {
        margin-right: 20px;
      }
      .cart{
            color: black;
            text-decoration: none;
            list-style: none;
        }

      .search-form {
        max-width: 500px;
        width: 100%;
        display: flex;
        align-items: center;
        border: 1px solid #7b4a9e;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        position: relative;
      }

      .search-form .form-control {
        border: none;
        border-radius: 8px 0 0 8px;
        height: 38px;
        padding: 0.5rem 1rem;
        box-shadow: none;
      }

      .search-form .btn {
        border-radius: 0 8px 8px 0;
        padding: 0 1rem;
        background-color: #7b4a9e;
        border: none;
        color: white;
      }

      #suggestionBoxForService {
        position: absolute;
        top: 100%;
        width: 30%;
        max-height: 200px;
        overflow-y: auto;
        background: white;
        border: 1px solid #ddd;
        z-index: 1000;
        /* Giúp hiển thị đè lên các phần tử khác */
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      }

      #suggestionBoxForService div {
        padding: 10px;
        cursor: pointer;
        border-bottom: 1px solid #ddd;
      }

      #suggestionBoxForService div:hover {
        background-color: #f8f9fa;
      }
    </style>
  </head>
  <body>
    <div>
      <nav class="navbar navbar-expand-lg top-nav">
        <div class="container-fluid">
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">Call us: 0585857306</li>
              <li class="nav-item">Email: petstore@gmail.com</li>
            </ul>
            <div class="d-flex gap-3">
              <a href="#" target="_blank" style="color: white">
                <i class="fab fa-facebook-square"></i>
              </a>
              <a href="#" target="_blank" style="color: white">
                <i class="fab fa-instagram"></i>
              </a>
            </div>
          </div>
        </div>
      </nav>
      <nav
        class="navbar navbar-expand-lg"
        style="
          background-color: white;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        "
      >
        <div class="container-fluid">
          <a class="navbar-brand d-flex align-items-center" href="/">
            <img
              src="/images/logo.png"
              alt="PetStore Logo"
              width="50"
              height="50"
              class="me-2"
            />
            <span>PetStore</span>
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarContent"
            aria-controls="navbarContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="/">Home</a>
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  Pets
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <a
                      class="dropdown-item"
                      href="/products?category=67cfb5625b64caf653f70ebc&page=1"
                      >Dogs</a
                    >
                  </li>
                  <li><hr class="dropdown-divider" /></li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="/products?category=67cfb5695b64caf653f70ebe&page=1"
                      >Cats</a
                    >
                  </li>
                </ul>
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  Pet Products
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <a
                      class="dropdown-item"
                      href="/products?category=67cfb5a25b64caf653f70ec0&page=1"
                      >Accessories</a
                    >
                  </li>
                  <li><hr class="dropdown-divider" /></li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="/products?category=67cff3f4a92e227c8ffbaf50&page=1"
                      >Food&Drinks</a
                    >
                  </li>
                  <li><hr class="dropdown-divider" /></li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="/products?category=67d16c6b20ed33fab00ec9ed&page=1"
                      >Other Services</a
                    >
                  </li>
                </ul>
              </li>
            </ul>
            <div class="navbar-collapse" style="flex-direction: column">
              <div style="width: 100%; align-self: center">
                <form
                  action="/products/search"
                  class="search-form mx-auto"
                  role="search"
                  method="get"
                >
                  <input
                    class="form-control"
                    type="search"
                    placeholder="Enter the product you are looking for"
                    aria-label="Search"
                    id="search"
                    name="keyword"
                    oninput="handleInput()"
                    onkeyup="handleSearch(event)"
                  />
                  <input type="hidden" id="index" name="index" value="1" />
                  <button
                    style="
                      background-color: #7b4a9e;
                      border: none;
                      color: white;
                      border-radius: 10%;
                      padding: 0.5rem 1rem;
                    "
                    type="submit"
                  >
                    <i class="fas fa-search"></i>
                  </button>
                </form>
              </div>
              <div id="suggestionBoxForService"></div>
            </div>

            <!-- Logic hiển thị Login hoặc User Dropdown -->
            <div class="d-flex align-items-center gap-3">
              <% if(!user) {%>
              <a class = "btn btn-outline-success" href="/auth/register">Register</a>
              <a class="btn btn-outline-success" href="/auth/login">Login</a>
              <% } else {%>
              <i class="fas fa-shopping-cart"></i>
              <a class="cart me-3" href="#">Cart</a>
              <div class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <i class="fas fa-user"></i>
                  <!-- Hiển thị tên user nếu muốn -->
                  <span> <%= user.name %> </span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <a class="dropdown-item" href="#">
                      <i class="fas fa-coins me-2"></i>Points:
                      <!-- Thêm logic điểm nếu có -->
                    </a>
                  </li>
                  <li><hr class="dropdown-divider" /></li>
                  <li>
                    <a class="dropdown-item" href="/users/profile">
                      <i class="fas fa-user-edit me-2"></i>Edit Profile
                    </a>
                  </li>
                  <li><hr class="dropdown-divider" /></li>
                  <li>
                    <a class="dropdown-item" href="/auth/logout">
                      <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </a>
                  </li>
                </ul>
              </div>
              <% } %>
            </div>
          </div>
        </div>
      </nav>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("search");
        const suggestionBox = document.getElementById(
          "suggestionBoxForService"
        );

        function searchProduct() {
          let keyword = searchInput.value.trim();
          if (!keyword) {
            alert("Bạn chưa nhập từ khóa.");
            return;
          }
          window.location.href =
            "/products/search?keyword=" + encodeURIComponent(keyword);
        }

        function handleSearch(event) {
          if (event.key === "Enter") {
            event.preventDefault();
            searchProduct();
          }
        }

        let timeout = null;
        function handleInput() {
          clearTimeout(timeout);
          timeout = setTimeout(() => {
            let keyword = searchInput.value.trim();
            if (keyword.length < 1) {
              suggestionBox.style.display = "none";
              return;
            }

            fetch(`/products/suggestion?keyword=${encodeURIComponent(keyword)}`)
              .then((response) => response.json())
              .then((suggestions) => displaySuggestions(suggestions))
              .catch((error) =>
                console.error("Error fetching suggestions:", error)
              );
          }, 300);
        }

        function displaySuggestions(suggestions) {
          suggestionBox.innerHTML = "";
          if (suggestions.length === 0) {
            suggestionBox.style.display = "none";
            return;
          }

          suggestions.forEach((product) => {
            let suggestion = document.createElement("div");
            suggestion.innerText = `${product.name} - ${product.type}`;
            suggestion.style.padding = "5px";
            suggestion.style.borderBottom = "1px solid #ddd";
            suggestion.style.cursor = "pointer";
            suggestion.onclick = () => {
              window.location.href = `/products/search-page/${product._id}`;
            };
            suggestionBox.appendChild(suggestion);
          });

          suggestionBox.style.display = "block";
        }

        searchInput.addEventListener("input", handleInput);
        searchInput.addEventListener("keyup", handleSearch);
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
